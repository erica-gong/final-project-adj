---
title: "Boone Health"
output: html_notebook
---

Step1: Loading libraries and data
```{r}
# Load the tidyverse package
library(tidyverse)

# Load the readxl package to import the original datasets which are in Excel format
library(readxl)
```

The original data file has two header rows. The first row contains broad categories, while the second row provides specific variable names. The analysis needs to combine them into a single row of descriptive column names after importing the data.
Import 2024 data:
```{r}
#Read 2024 data starting from the second row (skip the first row)
data24 <- read_excel("data/2024_county_health_release_data_-_v1.xlsx", sheet=2, skip = 1)

#Read the first row (the category-level headers)
top_header <- read_excel("data/2024_county_health_release_data_-_v1.xlsx", sheet=2, col_names = FALSE)

#Combine the two header rows and clean up any "NA" in names
new_names <- paste0(top_header[1, ], "_", names(data24)) %>%  str_replace_all("NA_|_NA|NA", "") 

# Assign new column names
colnames(data24) <- new_names

#Filter the data of Boone County, Missouri
boone24 <- data24 %>% filter(State == "Missouri", County == "Boone") %>% mutate(year = 2024, .after = County) 
```

Import 2023 data:
```{r}
#Read 2023 data starting from the second row (skip the first row)
data23 <- read_excel("data/2023 County Health Rankings Data - v2.xlsx", sheet=4, skip = 1)

#Read the first row (the category-level headers)
top_header <- read_excel("data/2023 County Health Rankings Data - v2.xlsx", sheet=4, col_names = FALSE)

#Combine the two header rows and clean up any "NA" in names
new_names <- paste0(top_header[1, ], "_", names(data23)) %>%  str_replace_all("NA_|_NA|NA", "") 

# Assign new column names
colnames(data23) <- new_names

#Filter the data of Boone County, Missouri
boone23 <- data23 %>% filter(State == "Missouri", County == "Boone") %>% mutate(year = 2023, .after = County)
```

Import 2022 data:
```{r}
#Read 2022 data starting from the second row (skip the first row)
data22 <- read_excel("data/2022 County Health Rankings Data - v1.xlsx", sheet=4, skip = 1)

#Read the first row (the category-level headers)
top_header <- read_excel("data/2022 County Health Rankings Data - v1.xlsx", sheet=4, col_names = FALSE)

#Combine the two header rows and clean up any "NA" in names
new_names <- paste0(top_header[1, ], "_", names(data22)) %>%  str_replace_all("NA_|_NA|NA", "") 

# Assign new column names
colnames(data22) <- new_names

#Filter the data of Boone County, Missouri
boone22 <-data22 %>% filter(State == "Missouri", County == "Boone") %>% mutate(year = 2022, .after = County)
```

Import 2021 data:
```{r}
#Read 2021 data starting from the second row (skip the first row)
data21 <- read_excel("data/2021 County Health Rankings Data - v1.xlsx", sheet=4, skip = 1)

#Read the first row (the category-level headers)
top_header <- read_excel("data/2021 County Health Rankings Data - v1.xlsx", sheet=4, col_names = FALSE)

#Combine the two header rows and clean up any "NA" in names
new_names <- paste0(top_header[1, ], "_", names(data21)) %>%  str_replace_all("NA_|_NA|NA", "") 

# Assign new column names
colnames(data21) <- new_names

#Filter the data of Boone County, Missouri
boone21 <- data21 %>% filter(State == "Missouri", County == "Boone") %>% mutate(year = 2021, .after = County)
```

Import 2020 data:
```{r}
#Read 2020 data starting from the second row (skip the first row)
data20 <- read_excel("data/2020 County Health Rankings Data - v2.xlsx", sheet=4, skip = 1)

#Read the first row (the category-level headers)
top_header <- read_excel("data/2020 County Health Rankings Data - v2.xlsx", sheet=4, col_names = FALSE)

#Combine the two header rows and clean up any "NA" in names
new_names <- paste0(top_header[1, ], "_", names(data20)) %>%  str_replace_all("NA_|_NA|NA", "") 

# Assign new column names
colnames(data20) <- new_names

#Filter the data of Boone County, Missouri
boone20 <- data20 %>% filter(State == "Missouri", County == "Boone") %>% mutate(year = 2020, .after = County)
```

Import 2019 data:
```{r}
#Read 2019 data starting from the second row (skip the first row)
data19 <- read_excel("data/2019 County Health Rankings Data - v3.xlsx", sheet=4, skip = 1)

#Read the first row (the category-level headers)
top_header <- read_excel("data/2019 County Health Rankings Data - v3.xlsx", sheet=4, col_names = FALSE)

#Combine the two header rows and clean up any "NA" in names
new_names <- paste0(top_header[1, ], "_", names(data19)) %>%  str_replace_all("NA_|_NA|NA", "") 

# Assign new column names
colnames(data19) <- new_names

#Filter the data of Boone County, Missouri
boone19 <- data19 %>% filter(State == "Missouri", County == "Boone") %>% mutate(year = 2019, .after = County)
```

Import 2018 data:
```{r}
#Read 2018 data starting from the second row (skip the first row)
data18 <- read_excel("data/2018 County Health Rankings Data - v2.xlsx", sheet=4, skip = 1)

#Read the first row (the category-level headers)
top_header <- read_excel("data/2018 County Health Rankings Data - v2.xlsx", sheet=4, col_names = FALSE)

#Combine the two header rows and clean up any "NA" in names
new_names <- paste0(top_header[1, ], "_", names(data18)) %>%  str_replace_all("NA_|_NA|NA", "") 

# Assign new column names
colnames(data18) <- new_names

#Filter the data of Boone County, Missouri
boone18 <- data18 %>% filter(State == "Missouri", County == "Boone") %>% mutate(year = 2018, .after = County)
```

Import 2017 data:
```{r}
#Read 2017 data starting from the second row (skip the first row)
data17 <- read_excel("data/2017CountyHealthRankingsData.xlsx", sheet=4, skip = 1)

#Read the first row (the category-level headers)
top_header <- read_excel("data/2017CountyHealthRankingsData.xlsx", sheet=4, col_names = FALSE)

#Combine the two header rows and clean up any "NA" in names
new_names <- paste0(top_header[1, ], "_", names(data17)) %>%  str_replace_all("NA_|_NA|NA", "") 

# Assign new column names
colnames(data17) <- new_names

#Filter the data of Boone County, Missouri
boone17 <- data17 %>% filter(State == "Missouri", County == "Boone") %>% mutate(year = 2017, .after = County)
```

Import 2016 data:
```{r}
#Read 2016 data starting from the second row (skip the first row)
data16 <- read_excel("data/2016 County Health Rankings Data - v3.xlsx", sheet=4, skip = 1)

#Read the first row (the category-level headers)
top_header <- read_excel("data/2016 County Health Rankings Data - v3.xlsx", sheet=4, col_names = FALSE)

#Combine the two header rows and clean up any "NA" in names
new_names <- paste0(top_header[1, ], "_", names(data16)) %>%  str_replace_all("NA_|_NA|NA", "") 

# Assign new column names
colnames(data16) <- new_names

#Filter the data of Boone County, Missouri
boone16 <- data16 %>% filter(State == "Missouri", County == "Boone") %>% mutate(year = 2016, .after = County)
```

Import 2015 data:
```{r}
#Read 2015 data starting from the second row (skip the first row)
data15 <- read_excel("data/2015 County Health Rankings Data - v3.xlsx", sheet=4, skip = 1)

#Read the first row (the category-level headers)
top_header <- read_excel("data/2015 County Health Rankings Data - v3.xlsx", sheet=4, col_names = FALSE)

#Combine the two header rows and clean up any "NA" in names
new_names <- paste0(top_header[1, ], "_", names(data15)) %>%  str_replace_all("NA_|_NA|NA", "") 

# Assign new column names
colnames(data15) <- new_names

#Filter the data of Boone County, Missouri
boone15 <- data15 %>% filter(State == "Missouri", County == "Boone") %>% mutate(year = 2015, .after = County)
```

Step2: Checking data boundries, cleaning data, and joining tables

Check data boundaries:
Are there any inconsistencies in the columns? (col_summary created)
```{r}
# Create a named list of all yearly Boone County data frames (2015–2024)
boone_list <- list(
  `2015` = boone15,
  `2016` = boone16,
  `2017` = boone17,
  `2018` = boone18,
  `2019` = boone19,
  `2020` = boone20,
  `2021` = boone21,
  `2022` = boone22,
  `2023` = boone23,
  `2024` = boone24)

# Extract the column names from each year's dataset to compare their structures
boone_colnames <- lapply(boone_list, names)

# Convert column name lists into a long-format data frame with Year and Variable columns
col_check <- imap_dfr(boone_colnames, ~ tibble(Year = .y, Variable = .x))

# Create a presence/absence matrix to show which variables appear in which years
col_summary <- col_check %>%
  mutate(HasVariable = TRUE) %>%
  pivot_wider(names_from = Year, values_from = HasVariable, values_fill = FALSE)
```
Findings: The variables across the annual datasets vary. Firstly, some variables have unnecessary numeric suffixes(e.g., "...6", "...7") and symbols (e.g., #). Secondly, some variables with the same meaning have different capitalizations. 

Clean the variable names:
```{r}
# Remove numeric suffixes (e.g., "...6") to standardize variable names.
# Remove unnecessary symbols (#), but keep underscores (_) and percentage signs (%).
# Make variables all lowercase for consistency.
boone24 <- boone24 %>%
  rename_with(function(x) {
    x %>%
      str_remove("\\.\\.\\.\\d+$") %>%
      str_replace_all("[^[:alnum:]_%]", "") %>%
      str_to_lower()
  })

boone23 <- boone23 %>%
  rename_with(function(col) {
    col %>%
      str_remove("\\.\\.\\.\\d+$") %>%
      str_replace_all("[^[:alnum:]_%]", "") %>%
      str_to_lower()
  })

boone22 <- boone22 %>%
  rename_with(function(col) {
    col %>%
      str_remove("\\.\\.\\.\\d+$") %>%
      str_replace_all("[^[:alnum:]_%]", "") %>%
      str_to_lower()
  })

boone21 <- boone21 %>%
  rename_with(function(col) {
    col %>%
      str_remove("\\.\\.\\.\\d+$") %>%
      str_replace_all("[^[:alnum:]_%]", "") %>%
      str_to_lower()
  })

boone20 <- boone20 %>%
  rename_with(function(col) {
    col %>%
      str_remove("\\.\\.\\.\\d+$") %>%
      str_replace_all("[^[:alnum:]_%]", "") %>%
      str_to_lower()
  })

boone19 <- boone19 %>%
  rename_with(function(col) {
    col %>%
      str_remove("\\.\\.\\.\\d+$") %>%
      str_replace_all("[^[:alnum:]_%]", "") %>%
      str_to_lower()
  })

boone18 <- boone18 %>%
  rename_with(function(col) {
    col %>%
      str_remove("\\.\\.\\.\\d+$") %>%
      str_replace_all("[^[:alnum:]_%]", "") %>%
      str_to_lower()
  })

boone17 <- boone17 %>%
  rename_with(function(col) {
    col %>%
      str_remove("\\.\\.\\.\\d+$") %>%
      str_replace_all("[^[:alnum:]_%]", "") %>%
      str_to_lower()
  })

boone16 <- boone16 %>%
  rename_with(function(col) {
    col %>%
      str_remove("\\.\\.\\.\\d+$") %>%
      str_replace_all("[^[:alnum:]_%]", "") %>%
      str_to_lower()
  })

boone15 <- boone15 %>%
  rename_with(function(col) {
    col %>%
      str_remove("\\.\\.\\.\\d+$") %>%
      str_replace_all("[^[:alnum:]_%]", "") %>%
      str_to_lower()
  })
```

Check the variables of each table again to ensure uniformity (col_summary):
```{r}
# Create a named list of all yearly Boone County data frames (2015–2024)
boone_list <- list(
  `2015` = boone15,
  `2016` = boone16,
  `2017` = boone17,
  `2018` = boone18,
  `2019` = boone19,
  `2020` = boone20,
  `2021` = boone21,
  `2022` = boone22,
  `2023` = boone23,
  `2024` = boone24)

# Extract the column names from each year's dataset to compare their structures
boone_colnames <- lapply(boone_list, names)

# Convert column name lists into a long-format data frame with Year and Variable columns
col_check <- imap_dfr(boone_colnames, ~ tibble(Year = .y, Variable = .x))

# Create a presence/absence matrix(col_summary) to show which variables appear in which years
col_summary <- col_check %>%
  mutate(HasVariable = TRUE) %>%
  pivot_wider(names_from = Year, values_from = HasVariable, values_fill = FALSE)
```
Findings: After the first round of cleaning, now there are 445 variables in all ten datasets. The data need further cleaning. Some variables are consistent across all years and some are specific to certain years. 

Continue checking data boundaries:
What are the different variables in each table (different_variable)?
```{r}
# Check the different variables in each table (2015-2024)
different_variable <- col_summary %>% filter(`2015` == "FALSE"|
                       `2016` == "FALSE"|
                       `2017` == "FALSE"|
                       `2018` == "FALSE"|
                       `2019` == "FALSE"|
                       `2020` == "FALSE"|
                       `2021` == "FALSE"|
                       `2022` == "FALSE"|
                       `2023` == "FALSE"|
                       `2024` == "FALSE") 

# Check the number of different variables
different_variable %>% count()
```
Findings: There are 371 different variables in total. Some variables appeared consistently only during a subset of years. This indicates the need to further examine the consistency across years.

Are there any variables that appear consecutively in certain years?
```{r}
# Check the variables that appear consistently from 2020 to 2024 but are missing in other datasets
different_variable %>% filter(`2015` == "FALSE",
                       `2016` == "FALSE", 
                       `2017` == "FALSE", 
                       `2018` == "FALSE", 
                       `2019` == "FALSE", 
                       `2020` == "TRUE", 
                       `2021` == "TRUE", 
                       `2022` == "TRUE", 
                       `2023` == "TRUE",
                       `2024` == "TRUE") 

# Check the variables that appear consistently from 2015 to 2019 but are missing in other datasets
different_variable %>% filter(`2024` == "FALSE",
                       `2023` == "FALSE", 
                       `2022` == "FALSE", 
                       `2021` == "FALSE", 
                       `2020` == "FALSE", 
                       `2019` == "TRUE", 
                       `2018` == "TRUE", 
                       `2017` == "TRUE", 
                       `2016` == "TRUE",
                       `2015` == "TRUE")
```
Findings: Some variables have the same meaning but are labeled differently in the 2015–2019 datasets compared to those in 2020–2024.

```{r}
# Check the variables that appear consistently from 2015 to 2023 but are missing in the 2024 dataset
different_variable %>% filter(`2015` == "TRUE",
                       `2016` == "TRUE", 
                       `2017` == "TRUE", 
                       `2018` == "TRUE", 
                       `2019` == "TRUE", 
                       `2020` == "TRUE", 
                       `2021` == "TRUE", 
                       `2022` == "TRUE", 
                       `2023` == "TRUE",
                       `2024` == "FALSE") 

# Check the number of quartile-based variables
different_variable %>% filter(`2015` == "TRUE",
                       `2016` == "TRUE", 
                       `2017` == "TRUE", 
                       `2018` == "TRUE", 
                       `2019` == "TRUE", 
                       `2020` == "TRUE", 
                       `2021` == "TRUE", 
                       `2022` == "TRUE", 
                       `2023` == "TRUE",
                       `2024` == "FALSE") %>% 
  filter(grepl("quartile", Variable, ignore.case = TRUE))
```
Findings: A total of 31 quartile variables appear consistently from 2015 to 2023 but are missing in the 2024 dataset, all of which are related to quartile measurement. In previous years, quartile values were used to represent county-level health factor rankings within each state, where 1 = top quartile, 2 = second quartile, 3 = third quartile, and 4 = bottom quartile.

Are there any variables that only appear in certain years?
```{r}
# Check the variables that only appear in the 2024 dataset
different_variable %>% filter(`2015` == "FALSE",
                       `2016` == "FALSE", 
                       `2017` == "FALSE", 
                       `2018` == "FALSE", 
                       `2019` == "FALSE", 
                       `2020` == "FALSE", 
                       `2021` == "FALSE", 
                       `2022` == "FALSE", 
                       `2023` == "FALSE",
                       `2024` == "TRUE")

# Check the variables that only appear in the 2024 dataset and are related to National Z-Score.
different_variable %>% filter(`2015` == "FALSE",
                       `2016` == "FALSE", 
                       `2017` == "FALSE", 
                       `2018` == "FALSE", 
                       `2019` == "FALSE", 
                       `2020` == "FALSE", 
                       `2021` == "FALSE", 
                       `2022` == "FALSE", 
                       `2023` == "FALSE",
                       `2024` == "TRUE") %>% 
  filter(grepl("zscore", Variable, ignore.case = TRUE))

# Check the variables that only appear in the 2024 dataset and are related to races.
different_variable %>% filter(`2015` == "FALSE",
                       `2016` == "FALSE", 
                       `2017` == "FALSE", 
                       `2018` == "FALSE", 
                       `2019` == "FALSE", 
                       `2020` == "FALSE", 
                       `2021` == "FALSE", 
                       `2022` == "FALSE", 
                       `2023` == "FALSE",
                       `2024` == "TRUE") %>% 
  filter(grepl("hispanic", Variable, ignore.case = TRUE))

# Check the variables that only appear in the 2023 dataset
different_variable %>% filter(`2015` == "FALSE",
                       `2016` == "FALSE", 
                       `2017` == "FALSE", 
                       `2018` == "FALSE", 
                       `2019` == "FALSE", 
                       `2020` == "FALSE", 
                       `2021` == "FALSE", 
                       `2022` == "FALSE", 
                       `2023` == "TRUE",
                       `2024` == "FALSE")

# Check the variables that only appear in the 2022 dataset
different_variable %>% filter(`2015` == "FALSE",
                       `2016` == "FALSE", 
                       `2017` == "FALSE", 
                       `2018` == "FALSE", 
                       `2019` == "FALSE", 
                       `2020` == "FALSE", 
                       `2021` == "FALSE", 
                       `2022` == "TRUE", 
                       `2023` == "FALSE",
                       `2024` == "FALSE")

# Check the variables that only appear in the 2021 dataset
different_variable %>% filter(`2015` == "FALSE",
                       `2016` == "FALSE", 
                       `2017` == "FALSE", 
                       `2018` == "FALSE", 
                       `2019` == "FALSE", 
                       `2020` == "FALSE", 
                       `2021` == "TRUE", 
                       `2022` == "FALSE", 
                       `2023` == "FALSE",
                       `2024` == "FALSE")

# Check the variables that only appear in the 2020 dataset
different_variable %>% filter(`2015` == "FALSE",
                       `2016` == "FALSE", 
                       `2017` == "FALSE", 
                       `2018` == "FALSE", 
                       `2019` == "FALSE", 
                       `2020` == "TRUE", 
                       `2021` == "FALSE", 
                       `2022` == "FALSE", 
                       `2023` == "FALSE",
                       `2024` == "FALSE")

# Check the variables that only appear in the 2019 dataset
different_variable %>% filter(`2015` == "FALSE",
                       `2016` == "FALSE", 
                       `2017` == "FALSE", 
                       `2018` == "FALSE", 
                       `2019` == "TRUE", 
                       `2020` == "FALSE", 
                       `2021` == "FALSE", 
                       `2022` == "FALSE", 
                       `2023` == "FALSE",
                       `2024` == "FALSE")

# Check the variables that only appear in the 2018 dataset
different_variable %>% filter(`2015` == "FALSE",
                       `2016` == "FALSE", 
                       `2017` == "FALSE", 
                       `2018` == "TRUE", 
                       `2019` == "FALSE", 
                       `2020` == "FALSE", 
                       `2021` == "FALSE", 
                       `2022` == "FALSE", 
                       `2023` == "FALSE",
                       `2024` == "FALSE")

# Check the variables that only appear in the 2017 dataset
different_variable %>% filter(`2015` == "FALSE",
                       `2016` == "FALSE", 
                       `2017` == "TRUE", 
                       `2018` == "FALSE", 
                       `2019` == "FALSE", 
                       `2020` == "FALSE", 
                       `2021` == "FALSE", 
                       `2022` == "FALSE", 
                       `2023` == "FALSE",
                       `2024` == "FALSE")

# Check the variables that only appear in the 2016 dataset
different_variable %>% filter(`2015` == "FALSE",
                       `2016` == "TRUE", 
                       `2017` == "FALSE", 
                       `2018` == "FALSE", 
                       `2019` == "FALSE", 
                       `2020` == "FALSE", 
                       `2021` == "FALSE", 
                       `2022` == "FALSE", 
                       `2023` == "FALSE",
                       `2024` == "FALSE")

# Check the variables that only appear in the 2015 dataset
different_variable %>% filter(`2015` == "TRUE",
                       `2016` == "FALSE", 
                       `2017` == "FALSE", 
                       `2018` == "FALSE", 
                       `2019` == "FALSE", 
                       `2020` == "FALSE", 
                       `2021` == "FALSE", 
                       `2022` == "FALSE", 
                       `2023` == "FALSE",
                       `2024` == "FALSE")
```
Findings1: There are 125 variables that appear only in the 2024 dataset. 34 of them are related to national z-scores, calculated using the formula (Measure − Average of U.S. counties) / Standard Deviation. The remaining 91 variables represent race-specific measurements for 4 key health outcomes:Premature Death (Years of Potential Life Lost Rate), Low Birth Weight (% LBW), Teen Birth Rate, and Injury Death Rate.In the 2024 dataset, two additional race categories were introduced: Non-Hispanic Native Hawaiian and Other Pacific Islander and Non-Hispanic 2+ Races. The other race categories — Hispanic (all races), Non-Hispanic American Indian/Alaska Native (AIAN), Non-Hispanic Asian, Non-Hispanic Black, and Non-Hispanic White — were also present in the previous nine years of data, but their names differ slightly, requiring standardization for consistent analysis.
Findings2: The "mammographyscreening_%screened" variable in boone19 table shares the same meaning of "mammographyscreening_%withannualmammogram" in boone20-24 tables (Percentage of female Medicare enrollees having an annual mammogram (age 65-74)). In 2015-2018, percentage of female Medicare enrollees having at least 1 mammogram in 2 yrs (age 67-69) was measures.
Findings3: There is inconsistency in the naming of "ypll" variables in boone18 table.The "prematuredeath_yearsofpotentiallifelostrateblack" variable in boone18 table shares the same meaning of "prematuredeath_ypllrateblack" in other tables.

Continue cleaning the data:
Standardize variable names:
```{r}
# Rename the variables with the same meaning but with different names.
boone24 <- boone24 %>%
  rename_with(~ case_when(
        # Physically unhealthy days
        . == "poorphysicalhealthdays_physicallyunhealthydays" ~ "poorphysicalhealthdays_averagenumberofphysicallyunhealthydays",
        
        # Mental health days
        . == "poormentalhealthdays_mentallyunhealthydays" ~ "poormentalhealthdays_averagenumberofmentallyunhealthydays",
        
        # Low birth weight
        . == "lowbirthweight_%lbw" ~ "lowbirthweight_%lowbirthweight",
        
        # Adult obesity
        . == "adultobesity_%obese" ~ "adultobesity_%adultswithobesity",

        # Adult smoking
        . == "adultsmoking_%smokers" ~ "adultsmoking_%adultsreportingcurrentlysmoking",
       
        # Access to exercise opportunities
        . == "accesstoexerciseopportunities_%withaccess" ~ "accesstoexerciseopportunities_%withaccesstoexerciseopportunities",
   
        # Primary care physicians
        . == "primarycarephysicians_pcprate" ~ "primarycarephysicians_primarycarephysiciansrate",
        . == "primarycarephysicians_pcpratio" ~ "primarycarephysicians_primarycarephysiciansratio",
        
        # Mental health providers
        . == "mentalhealthproviders_mhprate" ~ "mentalhealthproviders_mentalhealthproviderrate",
        . == "mentalhealthproviders_mhpratio" ~ "mentalhealthproviders_mentalhealthproviderratio",
        
        # Alcohol-impaired driving deaths
        . == "alcoholimpaireddrivingdeaths_%alcoholimpaired" ~ "alcoholimpaireddrivingdeaths_%drivingdeathswithalcoholinvolvement",
        
        # Driving alone to work
        . == "drivingalonetowork_%drivealone" ~ "drivingalonetowork_%drivealonetowork",
        
        # Fair/poor health
        . == "poororfairhealth_%fairpoor" ~ "poororfairhealth_%fairorpoorhealth",
        
        # High school graduation
        . == "highschoolgraduation_graduationrate" ~ "highschoolgraduation_highschoolgraduationrate",
        
        # Preventable hospital stays
        . == "preventablehospitalstays_preventablehosprate" ~ "preventablehospitalstays_preventablehospitalizationrate",
      
        # Social associations
        . == "socialassociations_associationrate" ~ "socialassociations_socialassociationrate",
        TRUE ~ .
  ))

boone23 <- boone23 %>%
  rename_with(~ case_when(
        # Physically unhealthy days
        . == "poorphysicalhealthdays_physicallyunhealthydays" ~ "poorphysicalhealthdays_averagenumberofphysicallyunhealthydays",  
        
        # Mental health days
        . == "poormentalhealthdays_mentallyunhealthydays" ~ "poormentalhealthdays_averagenumberofmentallyunhealthydays",
        
        # Low birth weight
        . == "lowbirthweight_%lbw" ~ "lowbirthweight_%lowbirthweight",
        
        # Adult obesity
        . == "adultobesity_%obese" ~ "adultobesity_%adultswithobesity",

        # Adult smoking
        . == "adultsmoking_%smokers" ~ "adultsmoking_%adultsreportingcurrentlysmoking",
       
        # Access to exercise opportunities
        . == "accesstoexerciseopportunities_%withaccess" ~ "accesstoexerciseopportunities_%withaccesstoexerciseopportunities",
   
        # Primary care physicians
        . == "primarycarephysicians_pcprate" ~ "primarycarephysicians_primarycarephysiciansrate",
        . == "primarycarephysicians_pcpratio" ~ "primarycarephysicians_primarycarephysiciansratio",
        
        # Mental health providers
        . == "mentalhealthproviders_mhprate" ~ "mentalhealthproviders_mentalhealthproviderrate",
        . == "mentalhealthproviders_mhpratio" ~ "mentalhealthproviders_mentalhealthproviderratio",
        
        # Alcohol-impaired driving deaths
        . == "alcoholimpaireddrivingdeaths_%alcoholimpaired" ~ "alcoholimpaireddrivingdeaths_%drivingdeathswithalcoholinvolvement",
        
        # Driving alone to work
        . == "drivingalonetowork_%drivealone" ~ "drivingalonetowork_%drivealonetowork",
        
        # Fair/poor health
        . == "poororfairhealth_%fairpoor" ~ "poororfairhealth_%fairorpoorhealth",
        
        # High school graduation
        . == "highschoolgraduation_graduationrate" ~ "highschoolgraduation_highschoolgraduationrate",
        
        # Preventable hospital stays
        . == "preventablehospitalstays_preventablehosprate" ~ "preventablehospitalstays_preventablehospitalizationrate",
      
        # Social associations
        . == "socialassociations_associationrate" ~ "socialassociations_socialassociationrate",
        TRUE ~ .
  ))

boone22 <- boone22 %>%
  rename_with(~ case_when(
        # Physically unhealthy days
        . == "poorphysicalhealthdays_physicallyunhealthydays" ~ "poorphysicalhealthdays_averagenumberofphysicallyunhealthydays",
        
        # Mental health days
        . == "poormentalhealthdays_mentallyunhealthydays" ~ "poormentalhealthdays_averagenumberofmentallyunhealthydays",
        
        # Low birth weight
        . == "lowbirthweight_%lbw" ~ "lowbirthweight_%lowbirthweight",
        
        # Adult obesity
        . == "adultobesity_%obese" ~ "adultobesity_%adultswithobesity",

        # Adult smoking
        . == "adultsmoking_%smokers" ~ "adultsmoking_%adultsreportingcurrentlysmoking",
       
        # Access to exercise opportunities
        . == "accesstoexerciseopportunities_%withaccess" ~ "accesstoexerciseopportunities_%withaccesstoexerciseopportunities",
   
        # Primary care physicians
        . == "primarycarephysicians_pcprate" ~ "primarycarephysicians_primarycarephysiciansrate",
        . == "primarycarephysicians_pcpratio" ~ "primarycarephysicians_primarycarephysiciansratio",
        
        # Mental health providers
        . == "mentalhealthproviders_mhprate" ~ "mentalhealthproviders_mentalhealthproviderrate",
        . == "mentalhealthproviders_mhpratio" ~ "mentalhealthproviders_mentalhealthproviderratio",
        
        # Alcohol-impaired driving deaths
        . == "alcoholimpaireddrivingdeaths_%alcoholimpaired" ~ "alcoholimpaireddrivingdeaths_%drivingdeathswithalcoholinvolvement",
        
        # Driving alone to work
        . == "drivingalonetowork_%drivealone" ~ "drivingalonetowork_%drivealonetowork",
        
        # Fair/poor health
        . == "poororfairhealth_%fairpoor" ~ "poororfairhealth_%fairorpoorhealth",
        
        # High school graduation
        . == "highschoolgraduation_graduationrate" ~ "highschoolgraduation_highschoolgraduationrate",
        
        # Preventable hospital stays
        . == "preventablehospitalstays_preventablehosprate" ~ "preventablehospitalstays_preventablehospitalizationrate",
      
        # Social associations
        . == "socialassociations_associationrate" ~ "socialassociations_socialassociationrate",
        TRUE ~ .
  ))

boone21 <- boone21 %>%
  rename_with(~ case_when(
        # Physically unhealthy days
        . == "poorphysicalhealthdays_physicallyunhealthydays" ~ "poorphysicalhealthdays_averagenumberofphysicallyunhealthydays",
        
        # Mental health days
        . == "poormentalhealthdays_mentallyunhealthydays" ~ "poormentalhealthdays_averagenumberofmentallyunhealthydays",
        
        # Low birth weight
        . == "lowbirthweight_%lbw" ~ "lowbirthweight_%lowbirthweight",
        
        # Adult obesity
        . == "adultobesity_%obese" ~ "adultobesity_%adultswithobesity",

        # Adult smoking
        . == "adultsmoking_%smokers" ~ "adultsmoking_%adultsreportingcurrentlysmoking",
       
        # Access to exercise opportunities
        . == "accesstoexerciseopportunities_%withaccess" ~ "accesstoexerciseopportunities_%withaccesstoexerciseopportunities",
   
        # Primary care physicians
        . == "primarycarephysicians_pcprate" ~ "primarycarephysicians_primarycarephysiciansrate",
        . == "primarycarephysicians_pcpratio" ~ "primarycarephysicians_primarycarephysiciansratio",
        
        # Mental health providers
        . == "mentalhealthproviders_mhprate" ~ "mentalhealthproviders_mentalhealthproviderrate",
        . == "mentalhealthproviders_mhpratio" ~ "mentalhealthproviders_mentalhealthproviderratio",
        
        # Alcohol-impaired driving deaths
        . == "alcoholimpaireddrivingdeaths_%alcoholimpaired" ~ "alcoholimpaireddrivingdeaths_%drivingdeathswithalcoholinvolvement",
        
        # Driving alone to work
        . == "drivingalonetowork_%drivealone" ~ "drivingalonetowork_%drivealonetowork",
        
        # Fair/poor health
        . == "poororfairhealth_%fairpoor" ~ "poororfairhealth_%fairorpoorhealth",
        
        # High school graduation
        . == "highschoolgraduation_graduationrate" ~ "highschoolgraduation_highschoolgraduationrate",
        
        # Preventable hospital stays
        . == "preventablehospitalstays_preventablehosprate" ~ "preventablehospitalstays_preventablehospitalizationrate",
      
        # Social associations
        . == "socialassociations_associationrate" ~ "socialassociations_socialassociationrate",
        TRUE ~ .
  ))

boone20 <- boone20 %>%
  rename_with(~ case_when(
        # Physically unhealthy days
        . == "poorphysicalhealthdays_physicallyunhealthydays" ~ "poorphysicalhealthdays_averagenumberofphysicallyunhealthydays",
        
        # Mental health days
        . == "poormentalhealthdays_mentallyunhealthydays" ~ "poormentalhealthdays_averagenumberofmentallyunhealthydays",
        
        # Low birth weight
        . == "lowbirthweight_%lbw" ~ "lowbirthweight_%lowbirthweight",
        
        # Adult obesity
        . == "adultobesity_%obese" ~ "adultobesity_%adultswithobesity",

        # Adult smoking
        . == "adultsmoking_%smokers" ~ "adultsmoking_%adultsreportingcurrentlysmoking",
       
        # Access to exercise opportunities
        . == "accesstoexerciseopportunities_%withaccess" ~ "accesstoexerciseopportunities_%withaccesstoexerciseopportunities",
   
        # Primary care physicians
        . == "primarycarephysicians_pcprate" ~ "primarycarephysicians_primarycarephysiciansrate",
        . == "primarycarephysicians_pcpratio" ~ "primarycarephysicians_primarycarephysiciansratio",
        
        # Mental health providers
        . == "mentalhealthproviders_mhprate" ~ "mentalhealthproviders_mentalhealthproviderrate",
        . == "mentalhealthproviders_mhpratio" ~ "mentalhealthproviders_mentalhealthproviderratio",
        
        # Alcohol-impaired driving deaths
        . == "alcoholimpaireddrivingdeaths_%alcoholimpaired" ~ "alcoholimpaireddrivingdeaths_%drivingdeathswithalcoholinvolvement",
        
        # Driving alone to work
        . == "drivingalonetowork_%drivealone" ~ "drivingalonetowork_%drivealonetowork",
        
        # Fair/poor health
        . == "poororfairhealth_%fairpoor" ~ "poororfairhealth_%fairorpoorhealth",
        
        # High school graduation
        . == "highschoolgraduation_graduationrate" ~ "highschoolgraduation_highschoolgraduationrate",
        
        # Preventable hospital stays
        . == "preventablehospitalstays_preventablehosprate" ~ "preventablehospitalstays_preventablehospitalizationrate",
      
        # Social associations
        . == "socialassociations_associationrate" ~ "socialassociations_socialassociationrate",
        TRUE ~ .
  ))

boone19 <- boone19 %>%
  rename_with(~ case_when(
        # Physically unhealthy days
        . == "poorphysicalhealthdays_physicallyunhealthydays" ~ "poorphysicalhealthdays_averagenumberofphysicallyunhealthydays",
        
        # Mental health days
        . == "poormentalhealthdays_mentallyunhealthydays" ~ "poormentalhealthdays_averagenumberofmentallyunhealthydays",
        
        # Low birth weight
        . == "lowbirthweight_%lbw" ~ "lowbirthweight_%lowbirthweight",
        
        # Adult obesity
        . == "adultobesity_%obese" ~ "adultobesity_%adultswithobesity",

        # Adult smoking
        . == "adultsmoking_%smokers" ~ "adultsmoking_%adultsreportingcurrentlysmoking",
       
        # Access to exercise opportunities
        . == "accesstoexerciseopportunities_%withaccess" ~ "accesstoexerciseopportunities_%withaccesstoexerciseopportunities",
   
        # Primary care physicians
        . == "primarycarephysicians_pcprate" ~ "primarycarephysicians_primarycarephysiciansrate",
        . == "primarycarephysicians_pcpratio" ~ "primarycarephysicians_primarycarephysiciansratio",
        
        # Mental health providers
        . == "mentalhealthproviders_mhprate" ~ "mentalhealthproviders_mentalhealthproviderrate",
        . == "mentalhealthproviders_mhpratio" ~ "mentalhealthproviders_mentalhealthproviderratio",
        
        # Alcohol-impaired driving deaths
        . == "alcoholimpaireddrivingdeaths_%alcoholimpaired" ~ "alcoholimpaireddrivingdeaths_%drivingdeathswithalcoholinvolvement",
        
        # Driving alone to work
        . == "drivingalonetowork_%drivealone" ~ "drivingalonetowork_%drivealonetowork",
        
        # Fair/poor health
        . == "poororfairhealth_%fairpoor" ~ "poororfairhealth_%fairorpoorhealth",
        
        # High school graduation
        . == "highschoolgraduation_graduationrate" ~ "highschoolgraduation_highschoolgraduationrate",
        
        # Preventable hospital stays
        . == "preventablehospitalstays_preventablehosprate" ~ "preventablehospitalstays_preventablehospitalizationrate",
        
        #Mammography Screening
        . == "mammographyscreening_%screened" ~ "mammographyscreening_%withannualmammogram",
      
        # Social associations
        . == "socialassociations_associationrate" ~ "socialassociations_socialassociationrate",
        TRUE ~ .
  ))

boone18 <- boone18 %>%
  rename_with(~ case_when(
        #Premature death
        . == "prematuredeath_yearsofpotentiallifelostrateblack" ~ "prematuredeath_ypllrateblack",
        . == "prematuredeath_yearsofpotentiallifelostratehispanic" ~ "prematuredeath_ypllratehispanic",
        . == "prematuredeath_yearsofpotentiallifelostratewhite" ~ "prematuredeath_ypllratewhite",
        
        # Physically unhealthy days
        . == "poorphysicalhealthdays_physicallyunhealthydays" ~ "poorphysicalhealthdays_averagenumberofphysicallyunhealthydays",
        
        # Mental health days
        . == "poormentalhealthdays_mentallyunhealthydays" ~ "poormentalhealthdays_averagenumberofmentallyunhealthydays",
        
        # Low birth weight
        . == "lowbirthweight_%lbw" ~ "lowbirthweight_%lowbirthweight",
        
        # Adult obesity
        . == "adultobesity_%obese" ~ "adultobesity_%adultswithobesity",

        # Adult smoking
        . == "adultsmoking_%smokers" ~ "adultsmoking_%adultsreportingcurrentlysmoking",
       
        # Access to exercise opportunities
        . == "accesstoexerciseopportunities_%withaccess" ~ "accesstoexerciseopportunities_%withaccesstoexerciseopportunities",
   
        # Primary care physicians
        . == "primarycarephysicians_pcprate" ~ "primarycarephysicians_primarycarephysiciansrate",
        . == "primarycarephysicians_pcpratio" ~ "primarycarephysicians_primarycarephysiciansratio",
        
        # Mental health providers
        . == "mentalhealthproviders_mhprate" ~ "mentalhealthproviders_mentalhealthproviderrate",
        . == "mentalhealthproviders_mhpratio" ~ "mentalhealthproviders_mentalhealthproviderratio",
        
        # Alcohol-impaired driving deaths
        . == "alcoholimpaireddrivingdeaths_%alcoholimpaired" ~ "alcoholimpaireddrivingdeaths_%drivingdeathswithalcoholinvolvement",
        
        # Driving alone to work
        . == "drivingalonetowork_%drivealone" ~ "drivingalonetowork_%drivealonetowork",
        
        # Fair/poor health
        . == "poororfairhealth_%fairpoor" ~ "poororfairhealth_%fairorpoorhealth",
        
        # High school graduation
        . == "highschoolgraduation_graduationrate" ~ "highschoolgraduation_highschoolgraduationrate",
        
        # Preventable hospital stays
        . == "preventablehospitalstays_preventablehosprate" ~ "preventablehospitalstays_preventablehospitalizationrate",
      
        # Social associations
        . == "socialassociations_associationrate" ~ "socialassociations_socialassociationrate",
        TRUE ~ .
  ))

boone17 <- boone17 %>%
  rename_with(~ case_when(
        # Physically unhealthy days
        . == "poorphysicalhealthdays_physicallyunhealthydays" ~ "poorphysicalhealthdays_averagenumberofphysicallyunhealthydays",
        
        # Mental health days
        . == "poormentalhealthdays_mentallyunhealthydays" ~ "poormentalhealthdays_averagenumberofmentallyunhealthydays",
        
        # Low birth weight
        . == "lowbirthweight_%lbw" ~ "lowbirthweight_%lowbirthweight",
        
        # Adult obesity
        . == "adultobesity_%obese" ~ "adultobesity_%adultswithobesity",

        # Adult smoking
        . == "adultsmoking_%smokers" ~ "adultsmoking_%adultsreportingcurrentlysmoking",
       
        # Access to exercise opportunities
        . == "accesstoexerciseopportunities_%withaccess" ~ "accesstoexerciseopportunities_%withaccesstoexerciseopportunities",
   
        # Primary care physicians
        . == "primarycarephysicians_pcprate" ~ "primarycarephysicians_primarycarephysiciansrate",
        . == "primarycarephysicians_pcpratio" ~ "primarycarephysicians_primarycarephysiciansratio",
        
        # Mental health providers
        . == "mentalhealthproviders_mhprate" ~ "mentalhealthproviders_mentalhealthproviderrate",
        . == "mentalhealthproviders_mhpratio" ~ "mentalhealthproviders_mentalhealthproviderratio",
        
        # Alcohol-impaired driving deaths
        . == "alcoholimpaireddrivingdeaths_%alcoholimpaired" ~ "alcoholimpaireddrivingdeaths_%drivingdeathswithalcoholinvolvement",
        
        # Driving alone to work
        . == "drivingalonetowork_%drivealone" ~ "drivingalonetowork_%drivealonetowork",
        
        # Fair/poor health
        . == "poororfairhealth_%fairpoor" ~ "poororfairhealth_%fairorpoorhealth",
        
        # High school graduation
        . == "highschoolgraduation_graduationrate" ~ "highschoolgraduation_highschoolgraduationrate",
        
        # Preventable hospital stays
        . == "preventablehospitalstays_preventablehosprate" ~ "preventablehospitalstays_preventablehospitalizationrate",
      
        # Social associations
        . == "socialassociations_associationrate" ~ "socialassociations_socialassociationrate",
        TRUE ~ .
  ))

boone16 <- boone16 %>%
  rename_with(~ case_when(
        # Physically unhealthy days
        . == "poorphysicalhealthdays_physicallyunhealthydays" ~ "poorphysicalhealthdays_averagenumberofphysicallyunhealthydays",
        
        # Mental health days
        . == "poormentalhealthdays_mentallyunhealthydays" ~ "poormentalhealthdays_averagenumberofmentallyunhealthydays",
        
        # Low birth weight
        . == "lowbirthweight_%lbw" ~ "lowbirthweight_%lowbirthweight",
        
        # Adult obesity
        . == "adultobesity_%obese" ~ "adultobesity_%adultswithobesity",

        # Adult smoking
        . == "adultsmoking_%smokers" ~ "adultsmoking_%adultsreportingcurrentlysmoking",
       
        # Access to exercise opportunities
        . == "accesstoexerciseopportunities_%withaccess" ~ "accesstoexerciseopportunities_%withaccesstoexerciseopportunities",
   
        # Primary care physicians
        . == "primarycarephysicians_pcprate" ~ "primarycarephysicians_primarycarephysiciansrate",
        . == "primarycarephysicians_pcpratio" ~ "primarycarephysicians_primarycarephysiciansratio",
        
        # Mental health providers
        . == "mentalhealthproviders_mhprate" ~ "mentalhealthproviders_mentalhealthproviderrate",
        . == "mentalhealthproviders_mhpratio" ~ "mentalhealthproviders_mentalhealthproviderratio",
        
        # Alcohol-impaired driving deaths
        . == "alcoholimpaireddrivingdeaths_%alcoholimpaired" ~ "alcoholimpaireddrivingdeaths_%drivingdeathswithalcoholinvolvement",
        
        # Driving alone to work
        . == "drivingalonetowork_%drivealone" ~ "drivingalonetowork_%drivealonetowork",
        
        # Fair/poor health
        . == "poororfairhealth_%fairpoor" ~ "poororfairhealth_%fairorpoorhealth",
        
        # High school graduation
        . == "highschoolgraduation_graduationrate" ~ "highschoolgraduation_highschoolgraduationrate",
        
        # Preventable hospital stays
        . == "preventablehospitalstays_preventablehosprate" ~ "preventablehospitalstays_preventablehospitalizationrate",
      
        # Social associations
        . == "socialassociations_associationrate" ~ "socialassociations_socialassociationrate",
        TRUE ~ .
  ))

boone15 <- boone15 %>%
  rename_with(~ case_when(
        # Physically unhealthy days
        . == "poorphysicalhealthdays_physicallyunhealthydays" ~ "poorphysicalhealthdays_averagenumberofphysicallyunhealthydays",
        
        # Mental health days
        . == "poormentalhealthdays_mentallyunhealthydays" ~ "poormentalhealthdays_averagenumberofmentallyunhealthydays",
        
        # Low birth weight
        . == "lowbirthweight_%lbw" ~ "lowbirthweight_%lowbirthweight",
        
        # Adult obesity
        . == "adultobesity_%obese" ~ "adultobesity_%adultswithobesity",

        # Adult smoking
        . == "adultsmoking_%smokers" ~ "adultsmoking_%adultsreportingcurrentlysmoking",
       
        # Access to exercise opportunities
        . == "accesstoexerciseopportunities_%withaccess" ~ "accesstoexerciseopportunities_%withaccesstoexerciseopportunities",
   
        # Primary care physicians
        . == "primarycarephysicians_pcprate" ~ "primarycarephysicians_primarycarephysiciansrate",
        . == "primarycarephysicians_pcpratio" ~ "primarycarephysicians_primarycarephysiciansratio",
        
        # Mental health providers
        . == "mentalhealthproviders_mhprate" ~ "mentalhealthproviders_mentalhealthproviderrate",
        . == "mentalhealthproviders_mhpratio" ~ "mentalhealthproviders_mentalhealthproviderratio",
        
        # Alcohol-impaired driving deaths
        . == "alcoholimpaireddrivingdeaths_%alcoholimpaired" ~ "alcoholimpaireddrivingdeaths_%drivingdeathswithalcoholinvolvement",
        
        # Driving alone to work
        . == "drivingalonetowork_%drivealone" ~ "drivingalonetowork_%drivealonetowork",
        
        # Fair/poor health
        . == "poororfairhealth_%fairpoor" ~ "poororfairhealth_%fairorpoorhealth",
        
        # High school graduation
        . == "highschoolgraduation_graduationrate" ~ "highschoolgraduation_highschoolgraduationrate",
        
        # Preventable hospital stays
        . == "preventablehospitalstays_preventablehosprate" ~ "preventablehospitalstays_preventablehospitalizationrate",
      
        # Social associations
        . == "socialassociations_associationrate" ~ "socialassociations_socialassociationrate",
        TRUE ~ .
  ))
```

Standardize the names of race-specific variables:
```{r}
# Rename the race-specific variables in boone24 table
boone24 <- boone24 %>%
  rename_with(~ case_when(
    str_detect(., "hispanicallraces") ~ str_replace(., "hispanicallraces", "hispanic"),
    str_detect(., "nonhispanicaian") ~ str_replace(., "nonhispanic", ""),
    str_detect(., "nonhispanicasian") ~ str_replace(., "nonhispanic", ""),
    str_detect(., "nonhispanicblack") ~ str_replace(., "nonhispanic", ""),
    str_detect(., "nonhispanicwhite") ~ str_replace(., "nonhispanic", ""),
    TRUE ~ .
  ))
```

Check the variables of each table again to ensure uniformity (col_summary2):
```{r}
# Create a named list of all yearly Boone County data frames (2015–2024)
boone_list <- list(
  `2015` = boone15,
  `2016` = boone16,
  `2017` = boone17,
  `2018` = boone18,
  `2019` = boone19,
  `2020` = boone20,
  `2021` = boone21,
  `2022` = boone22,
  `2023` = boone23,
  `2024` = boone24)

# Extract the column names from each year's dataset to compare their structures
boone_colnames <- lapply(boone_list, names)

# Convert column name lists into a long-format data frame with Year and Variable columns
col_check <- imap_dfr(boone_colnames, ~ tibble(Year = .y, Variable = .x))

# Create a presence/absence matrix(col_summary) to show which variables appear in which years
col_summary2 <- col_check %>%
  mutate(HasVariable = TRUE) %>%
  pivot_wider(names_from = Year, values_from = HasVariable, values_fill = FALSE)
```
Findings: After the second round of cleaning, now there are 360 variables in all ten datasets in total.

Continue checking data boundaries:
What are the different variables in each table (different_variable2)?
```{r}
# Check the different variables in each table (2015-2024)
different_variable2 <- col_summary2 %>% filter(`2015` == "FALSE"|
                       `2016` == "FALSE"|
                       `2017` == "FALSE"|
                       `2018` == "FALSE"|
                       `2019` == "FALSE"|
                       `2020` == "FALSE"|
                       `2021` == "FALSE"|
                       `2022` == "FALSE"|
                       `2023` == "FALSE"|
                       `2024` == "FALSE") 

# Check the number of different variables
different_variable2 %>% count()
```
Findings: Now there are 271 different variables in total.

Check again: Are there any variables that only appear in certain years?
```{r}
# Check the variables that only appear in the 2024 dataset
different_variable2 %>% filter(`2015` == "FALSE",
                       `2016` == "FALSE", 
                       `2017` == "FALSE", 
                       `2018` == "FALSE", 
                       `2019` == "FALSE", 
                       `2020` == "FALSE", 
                       `2021` == "FALSE", 
                       `2022` == "FALSE", 
                       `2023` == "FALSE",
                       `2024` == "TRUE")

# Check the variables that only appear in the 2024 dataset and are related to National Z-Score.
different_variable2 %>% filter(`2015` == "FALSE",
                       `2016` == "FALSE", 
                       `2017` == "FALSE", 
                       `2018` == "FALSE", 
                       `2019` == "FALSE", 
                       `2020` == "FALSE", 
                       `2021` == "FALSE", 
                       `2022` == "FALSE", 
                       `2023` == "FALSE",
                       `2024` == "TRUE") %>% 
  filter(grepl("zscore", Variable, ignore.case = TRUE))

# Check the variables that only appear in the 2024 dataset and are related to races.
different_variable2 %>% filter(`2015` == "FALSE",
                       `2016` == "FALSE", 
                       `2017` == "FALSE", 
                       `2018` == "FALSE", 
                       `2019` == "FALSE", 
                       `2020` == "FALSE", 
                       `2021` == "FALSE", 
                       `2022` == "FALSE", 
                       `2023` == "FALSE",
                       `2024` == "TRUE") %>% 
  filter(grepl("hispanic", Variable, ignore.case = TRUE))

# Check the variables that only appear in the 2023 dataset
different_variable2 %>% filter(`2015` == "FALSE",
                       `2016` == "FALSE", 
                       `2017` == "FALSE", 
                       `2018` == "FALSE", 
                       `2019` == "FALSE", 
                       `2020` == "FALSE", 
                       `2021` == "FALSE", 
                       `2022` == "FALSE", 
                       `2023` == "TRUE",
                       `2024` == "FALSE")

# Check the variables that only appear in the 2022 dataset
different_variable2 %>% filter(`2015` == "FALSE",
                       `2016` == "FALSE", 
                       `2017` == "FALSE", 
                       `2018` == "FALSE", 
                       `2019` == "FALSE", 
                       `2020` == "FALSE", 
                       `2021` == "FALSE", 
                       `2022` == "TRUE", 
                       `2023` == "FALSE",
                       `2024` == "FALSE")

# Check the variables that only appear in the 2021 dataset
different_variable2 %>% filter(`2015` == "FALSE",
                       `2016` == "FALSE", 
                       `2017` == "FALSE", 
                       `2018` == "FALSE", 
                       `2019` == "FALSE", 
                       `2020` == "FALSE", 
                       `2021` == "TRUE", 
                       `2022` == "FALSE", 
                       `2023` == "FALSE",
                       `2024` == "FALSE")

# Check the variables that only appear in the 2020 dataset
different_variable2 %>% filter(`2015` == "FALSE",
                       `2016` == "FALSE", 
                       `2017` == "FALSE", 
                       `2018` == "FALSE", 
                       `2019` == "FALSE", 
                       `2020` == "TRUE", 
                       `2021` == "FALSE", 
                       `2022` == "FALSE", 
                       `2023` == "FALSE",
                       `2024` == "FALSE")

# Check the variables that only appear in the 2019 dataset
different_variable2 %>% filter(`2015` == "FALSE",
                       `2016` == "FALSE", 
                       `2017` == "FALSE", 
                       `2018` == "FALSE", 
                       `2019` == "TRUE", 
                       `2020` == "FALSE", 
                       `2021` == "FALSE", 
                       `2022` == "FALSE", 
                       `2023` == "FALSE",
                       `2024` == "FALSE")

# Check the variables that only appear in the 2018 dataset
different_variable2 %>% filter(`2015` == "FALSE",
                       `2016` == "FALSE", 
                       `2017` == "FALSE", 
                       `2018` == "TRUE", 
                       `2019` == "FALSE", 
                       `2020` == "FALSE", 
                       `2021` == "FALSE", 
                       `2022` == "FALSE", 
                       `2023` == "FALSE",
                       `2024` == "FALSE")

# Check the variables that only appear in the 2017 dataset
different_variable2 %>% filter(`2015` == "FALSE",
                       `2016` == "FALSE", 
                       `2017` == "TRUE", 
                       `2018` == "FALSE", 
                       `2019` == "FALSE", 
                       `2020` == "FALSE", 
                       `2021` == "FALSE", 
                       `2022` == "FALSE", 
                       `2023` == "FALSE",
                       `2024` == "FALSE")

# Check the variables that only appear in the 2016 dataset
different_variable2 %>% filter(`2015` == "FALSE",
                       `2016` == "TRUE", 
                       `2017` == "FALSE", 
                       `2018` == "FALSE", 
                       `2019` == "FALSE", 
                       `2020` == "FALSE", 
                       `2021` == "FALSE", 
                       `2022` == "FALSE", 
                       `2023` == "FALSE",
                       `2024` == "FALSE")

# Check the variables that only appear in the 2015 dataset
different_variable2 %>% filter(`2015` == "TRUE",
                       `2016` == "FALSE", 
                       `2017` == "FALSE", 
                       `2018` == "FALSE", 
                       `2019` == "FALSE", 
                       `2020` == "FALSE", 
                       `2021` == "FALSE", 
                       `2022` == "FALSE", 
                       `2023` == "FALSE",
                       `2024` == "FALSE")
```
Findings: Data cleaned. Now there are 60 variables that appear only in the 2024 dataset. 34 of them are related to national z-scores. The remaining 26 variables represent two race categories: Non-Hispanic Native Hawaiian and Other Pacific Islander and Non-Hispanic 2+ Races. There are 5 variables that are specific to boone18. There are 8 variables that are specific to boone15. 

Are there any variables that appear consecutively in certain years?
```{r}
# Check race-specific variables
different_variable2 %>% filter(grepl("hispanic|black|white|aian|asian|2races|nativehawaiian", Variable, ignore.case = TRUE))

# Check the consistency of race-related measurement standards applied from 2020 to 2024
# Create a table of shared race-specific variables for further analysis
race_variable <- different_variable2 %>% 
  filter(grepl("hispanic|black|white|aian|asian|2races|nativehawaiian", Variable, ignore.case = TRUE)) %>% 
  filter(`2020` == "TRUE", `2021` == "TRUE", `2022` == "TRUE", `2023` == "TRUE", `2024` == "TRUE")
```
Findings: There are 130 race-specific variables related to various health indicators in total. Not all of these variables are consistently available across all ten years of data, making it impossible to track a full decade of trends. However, 95 of these race-related variables were measured using consistent standards from 2020 to 2024, allowing for a five-year trend analysis of those indicators.

What are the shared variables in every table?
```{r}
# Check the shared variables that are included in every table (2015-2024)
shared_variable <- col_summary2 %>% filter(`2015` == "TRUE",
                       `2016` == "TRUE", 
                       `2017` == "TRUE", 
                       `2018` == "TRUE", 
                       `2019` == "TRUE", 
                       `2020` == "TRUE", 
                       `2021` == "TRUE", 
                       `2022` == "TRUE", 
                       `2023` == "TRUE",
                       `2024` == "TRUE") 

# Check the number of shared variables
shared_variable %>% count()

# Check the number of shared variables which are related to confidence intervals ("95% CI - Low"/"95% CI - High")
shared_variable %>% filter(grepl("95%ci", Variable, ignore.case = T)) %>% select(Variable)
```
Findings: Due to changes in measurement standards across years, the number of consistent variables across all ten datasets is limited. There are 89 shared variables were identified. Among these, four are basic identifiers: FIPS code, State, County, and Year. There are 36 variables related to 95% Confidence Intervals (CI). These variables represent the statistical uncertainty around the point estimates of health indicators. 
In summary, the 10-year health trends for Boone County (2015–2024) can be analyzed using 89 consistently shared variables. Additionally, 5-year trends (2020–2024) can be examined through 95 race-specific variables that were measured using consistent standards. Other variables, which differ across years due to changes in measurement definitions or scope, may require further reporting or other data sources.

Join the tables based on shared variables for further analysis:
Combine annual datasets for further analysis by extracting the shared variables across all years into one table:
```{r}
# Create table boone_health to contain variables consistently measured across all ten years from 2015 to 2024. Create table boone_health_race to contain race-related variables that were consistently measured during the five-year period from 2020 to 2024.
boone24_shared <- boone24 %>%
  select(all_of(c(pull(shared_variable, 1))))

boone24_race<- boone24 %>%
  select(all_of(c("fips", "state", "county", "year", pull(race_variable, 1))))

boone23_shared <- boone23 %>%
  select(all_of(c(pull(shared_variable, 1))))

boone23_race<- boone23 %>%
  select(all_of(c("fips", "state", "county", "year", pull(race_variable, 1))))

boone22_shared <- boone22 %>%
  select(all_of(c(pull(shared_variable, 1))))

boone22_race<- boone22 %>%
  select(all_of(c("fips", "state", "county", "year", pull(race_variable, 1))))

boone21_shared <- boone21 %>%
  select(all_of(c(pull(shared_variable, 1))))

boone21_race<- boone21 %>%
  select(all_of(c("fips", "state", "county", "year", pull(race_variable, 1))))

boone20_shared <- boone20 %>%
  select(all_of(c(pull(shared_variable, 1))))

boone20_race<- boone20 %>%
  select(all_of(c("fips", "state", "county", "year", pull(race_variable, 1))))

boone19_shared <- boone19 %>%
  select(all_of(c(pull(shared_variable, 1))))

boone18_shared <- boone18 %>%
  select(all_of(c(pull(shared_variable, 1))))

boone17_shared <- boone17 %>%
  select(all_of(c(pull(shared_variable, 1))))

boone16_shared <- boone16 %>%
  select(all_of(c(pull(shared_variable, 1))))

boone15_shared <- boone15 %>%
  select(all_of(c(pull(shared_variable, 1))))

boone_health <- bind_rows(boone24_shared, boone23_shared, boone22_shared, boone21_shared, boone20_shared, boone19_shared, boone18_shared, boone17_shared, boone16_shared, boone15_shared)

boone_health_race <-bind_rows(boone24_race, boone23_race, boone22_race, boone21_race, boone20_race)
```

Step3: General Overview 

1. boone_health table
What information does this dataset track?
Findings: This dataset from the University of Wisconsin Population Health Institute records the Health Outcome and Health Factor summaries of Boone county, Missouri.

How many rows and columns are in the dataset? What does each row represent?
```{r}
boone_health %>% summarise(num_rows = nrow(boone_health), num_columns = ncol(boone_health))
```
Findings: The dataset contains 10 rows and 89 columns. Each row represents data for one year (2015-2024), and each of the 89 columns corresponds to a specific health factor. The first four columns are basic identifiers: FIPS code, State, County, and Year.

Are there any missing values (NA)?
```{r}
boone_health %>% summarise(across(everything(), ~ sum(is.na(.)))) %>% select(where(~ . > 0))
```
Findings: The column lowbirthweight_unreliable contains only NA values across all ten years. This indicates that for the lowbirthweight measure, no data points were flagged as unreliable, likely because all reported values were based on sample sizes greater than 20 and meet the reliability threshold.

2. boone_health_race table
What information does this dataset track?
Findings: This dataset from the University of Wisconsin Population Health Institute records the race-specific Health Factor summaries of Boone county, Missouri.

How many rows and columns are in the dataset? What does each row represent?
```{r}
boone_health_race %>% summarise(num_rows = nrow(boone_health_race), num_columns = ncol(boone_health_race))
```
Findings: The dataset contains 5 rows and 99 columns. Each row represents data for one year (2020-2024). The first four columns are basic identifiers: FIPS code, State, County, and Year, and the rest 95 columns corresponds to a health factor measured separately for racial groups.

What races were measured?
Findings: After data cleaning based on the data dictionary, this dataset now includes the following five racial and ethnic groups: Hispanic, American Indian and Alaska Native (AIAN), Asian, Black, and White. What needs attention is that two new categories were added in the 2024 dataset: Non-Hispanic Native Hawaiian and Other Pacific Islander and Non-Hispanic Two or More Races. However, for Boone County, Missouri, in 2024, data for these two groups is mostly missing, except for low birthweight rate and teen birth rate under the "Non-Hispanic 2+ races" category.

Are there any missing values (NA)?
```{r}
# Data missing for all five years
boone_health_race %>% summarise(across(everything(), ~ sum(is.na(.)))) %>% select(where(~ . > 4))

# Data missing for four years
boone_health_race %>% summarise(across(everything(), ~ sum(is.na(.)))) %>% select(where(~ . > 3 & . < 5))

# Data missing for three years
boone_health_race %>% summarise(across(everything(), ~ sum(is.na(.)))) %>% select(where(~ . > 2 & . < 4))

# Data missing for two years
boone_health_race %>% summarise(across(everything(), ~ sum(is.na(.)))) %>% select(where(~ . > 1 & . < 3))

# Data missing for one year
boone_health_race %>% summarise(across(everything(), ~ sum(is.na(.)))) %>% select(where(~ . > 0 & . < 2))
```
Findings: In Boone County, Missouri, not every racial category has complete data for every year. There are 28 columns missing data for all five years (2020-2025). There are 3 columns missing data for four years. There are 4 columns missing data for three years. There is 1 column missing data for one year.

Step4: Analyzing data.

1. boone_health table
A. LENGTH OF LIFE
1) How has Years of Potential Life Lost Rate changed over the past 10 years (2015-2024)? Is early death becoming more common in Boone County?
```{r}
#The Years of Potential Life Lost rate shows how many total years of life were lost due to deaths before age 75, per 100,000 people.
boone_health %>% arrange(year) %>% select(year, prematuredeath_yearsofpotentiallifelostrate) 
```
Finding: Boone County is seeing more years of life lost to early death over the past decade. Between 2015 and 2024, the age-adjusted rate of potential life lost before age 75 increased from around 5,590 to more than 7,000 per 100,000 people. For every 100,000 residents in Boone County, a total of 7,087 years of life were lost due to people dying too youn in 2024.

B. QUALITY OF LIFE
2) How has the percentage of people in Boone County who report being in poor or fair health changed?
```{r}
#% Fair or Poor Health shows the percentage of adults that report fair or poor health
boone_health %>%
  arrange(year) %>%
  select(year, `poororfairhealth_%fairorpoorhealth`)
```
Finding: The percentage of Boone County residents reporting poor or fair health has fluctuated between about 13% and 17% in the past decade, with no clear long-term trend.

3) What are the trends in reported mental and physical health over the past decade?
```{r}
# Average number of physically unhealthy days	shows the average number of reported physically unhealthy days per month. Average number of mentally unhealthy days	shows the average number of reported mentally unhealthy days per month.
boone_health %>%
  arrange(year) %>%
  select(year, 
         poorphysicalhealthdays_averagenumberofphysicallyunhealthydays,
         poormentalhealthdays_averagenumberofmentallyunhealthydays)
```
Finding: Both physical and mental health have worsened over the past decade in Boone County. On average, people reported about one more day per month of poor physical health and about one and a half more days of poor mental health compared to ten years ago.Residents consistently reported more mentally unhealthy days than physically unhealthy days.

4) How has the percentage of babies born underweight changed in Boone County?
```{r}
#% Low Birthweight shows the percentage of births with low birthweight (<2500g)
boone_health %>%
  arrange(year) %>%
  select(year, `lowbirthweight_%lowbirthweight`)
```
Finding: The percentage of babies born with low birthweight has gradually increased in Boone County over the past decade. For every 100 births, one more baby is born underweight in 2024 compared to ten years ago.

HEALTH FACTORS-HEALTH BEHAVIORS
C.TOBACCO USE
5) How has the percentage of adults who smoke changed in Boone County over the last 10 years?
```{r}
# % Adults Reporting Currently Smoking shows the percentage of adults that reported currently smoking
boone_health %>%
  arrange(year) %>%
  select(year, `adultsmoking_%adultsreportingcurrentlysmoking`)
```
Finding: Smoking rates have declined in Boone County in the past two years. In 2015, about 18.5% of adults reported smoking, while in 2024 that number dropped to around 15.8%.

D. DIET AND EXERCISE
6) How has the percentage of adults with obesity and the access to healthy food changed in Boone County?
```{r}
#% Adults with Obesity shows the percentage of adults that report BMI >= 30
#Food Environment Index	is the indicator of access to healthy foods. 0 is worst, and 10 is best.
boone_health %>%
  arrange(year) %>%
  select(year, `adultobesity_%adultswithobesity`, foodenvironmentindex_foodenvironmentindex)
```
Finding: Access to healthy food in Boone County has slightly improved over the past decade, which means it is now a bit easier for residents to get healthy food options than it was in 2015.The food environment index was 7.1 in 2015, peaked at 7.7 in 2021, and reached 7.5 in 2024—a 0.4-point increase over ten years. However, the percentage of adults with obesity in Boone County has shown a clear increase over the past decade. There are 7 more people with obesity per 100 adults in 2024 than in 2015.

7) How have people’s physical activity levels and access to exercise opportunities changed in in Boone County over the past decade?
```{r}
# % Physically Inactive shows the percentage of adults that report no leisure-time physical activity. 
# % With Access to Exercise Opportunities shows the percentage of the population with access to places for physical activity.
boone_health %>%
  arrange(year) %>%
  select(year, `physicalinactivity_%physicallyinactive`,
         `accesstoexerciseopportunities_%withaccesstoexerciseopportunities`)
```
Finding: In Boone County, more people now have access to places where they can exercise—up from around 74% in 2015 to over 88% in 2024. However, the percentage of adults who report no leisure-time physical activity has fluctuated over the past decade with a slight upward trend.

E. ALCOHOL AND DRUG USE
8)How has alcohol use and alcohol-related traffic deaths changed?
```{r}
# Excessive Drinking shows the percentage of adults reporting binge or heavy drinking (age-adjusted).
# Alcohol-Impaired Driving Deaths	shows the percentage of driving deaths with alcohol involvement.
boone_health %>%
  arrange(year) %>%
  select(year, `excessivedrinking_%excessivedrinking`,
         `alcoholimpaireddrivingdeaths_%drivingdeathswithalcoholinvolvement`)
```
Finding: The percentage of adults reporting excessive drinking in Boone County rose from 2015 to 2016 but has stayed relatively stable between 2016 and 2024, fluctuating around 19–21%. Meanwhile, alcohol-related traffic deaths have clearly declined, dropping from nearly 49% in 2015 to 28% in 2024.

F.SEXUAL ACTIVITY
9)How has the rate of sexually transmitted infections changed?
```{r}
# Chlamydia Rate shows the number of reported chlamydia cases per 100,000 people.
boone_health %>%
  arrange(year) %>%
  select(year, sexuallytransmittedinfections_chlamydiarate)
```
Finding: Chlamydia rates peaked in 2021 and have since dropped slightly.

10) How has the teen birth rate changed in Boone County?
```{r}
#Teen Birth Rate shows how many females aged 15–19 gave birth per 1,000 teens.
boone_health %>%
  arrange(year) %>%
  select(year, teenbirths_teenbirthrate)
```
Finding: Teen births have decreased over the last decade. In 2015, about 20 out of 1,000 teen girls gave birth. In 2024, the number dropped to under 9.

HEALTH FACTORS-CLINICAL CARE
G. ACCESS TO CARE
11) How has the percentage of uninsured residents changed?
```{r}
# % Uninsured	shows the percentage of people under age 65 without insurance
boone_health %>%
  arrange(year) %>%
  select(year, `uninsured_%uninsured`)
```
Finding: The percentage of people in Boone County without health insurance has slightly decreased over the past decade. In 2015, about 15 out of every 100 residents were uninsured. By 2024, that number dropped to around 11 out of 100.

12) How has access to health care providers changed?
```{r}
# Primary Care Physicians Rate, Dentist Rate, and Mental Health Provider Rate show	the number of primary care doctors, dentists, and mental health providers per 100,000 people.
boone_health %>%
  arrange(year) %>%
  select(year,
         primarycarephysicians_primarycarephysiciansrate,
         dentists_dentistrate,
         mentalhealthproviders_mentalhealthproviderrate)
```
Finding: In Boone County, people today have better access to all three types of care than they did 10 years ago. The number of primary care doctors has grown from about 101 in 2015 to 118 in 2024 per 100,000 people.The number of dentists also increased, from around 59 to 75. Mental health providers saw the biggest jump, from 272 in 2015 to 430 in 2024.

H. QUALITY OF CARE
13) How has the rate of preventable hospital stays changed?
```{r}
# Preventable Hospitalization Rate in 2019-2024 datasets shows the	discharges for Ambulatory Care Sensitive Conditions per 100,000 Medicare Enrollees
#Preventable Hospitalization Rate in 2015-2018 datasets shows the	discharges for Ambulatory Care Sensitive Conditionsper 1,000 Medicare Enrollees
boone_health %>%
  arrange(year) %>%
  select(year, preventablehospitalstays_preventablehospitalizationrate)
```
Finding: Fewer people in Boone County who are on Medicare are ending up in the hospital for problems that could have been treated earlier, as the preventable hospitalization rate have dropped significantly.

HEALTH FACTORS-SOCIAL & ECONOMIC FACTORS
I. EDUCATION
14)How has college attendance rate changed?
```{r}
#Some College	means the percentage of adults ages 25-44 with some post-secondary education.
boone_health %>%
  arrange(year) %>%
  select(year, `somecollege_%somecollege`)
```
Finding: College participation is high and stable, hovering around 79–80% in Boone County over the past decade.

J. EMPLOYMENT
15)How has the unemployment rate changed?
```{r}
# % Unemployed shows the percentage of population ages 16+ unemployed and looking for work
boone_health %>%
  arrange(year) %>%
  select(year, `unemployment_%unemployed`)
```
Finding: Although unemployment temporarily increased in 2022, the overall trend over the past decade has been downward. In 2015, about 45 out of every 1,000 people were unemployed. By 2024, that number dropped to around 20 out of 1,000.

K. INCOME
16)How has the child poverty rate changed in Boone County?
```{r}
#% Children in Poverty shows the percentage of children (under age 18) living in poverty
boone_health %>%
  arrange(year) %>%
  select(year, `childreninpoverty_%childreninpoverty`)
```
Finding: The share of children living in poverty in Boone County has clearly gone down over the past decade. In 2016, about 18 out of every 100 children were living in poverty. By 2024, that number dropped to around 13 out of 100.

L. FAMILY AND SOCIAL SUPPORT
17) How has community engagement changed in Boone County?
```{r}
# Social Associations	shows the number of membership associations per 10,000 population.
boone_health %>%
  arrange(year) %>%
  select(year, socialassociations_socialassociationrate)
```
Finding: Community involvement dropped slightly in recent years, falling from over 12 to under 10 associations per 10,000 people.

M. COMMUNITY SAFETY
18)How has the injury death rate changed?
```{r}
#Injury Death Rate shows the injury mortality rate per 100,000 people
boone_health %>%
  arrange(year) %>%
  select(year, injurydeaths_injurydeathrate)
```
Finding: The injury death rate in Boone County first went down, from around 53 in 2016 to 46 in 2019, but then started to climb again in recent years. By 2024, it reached 63 deaths per 100,000 people, the highest in the past decade.

HEALTH FACTORS-PHYSICAL ENVIRONMENT
N. AIR QUALITY
19)How has air quality changed in Boone County?
```{r}
#Average Daily PM2.5 shows the average daily amount of fine particulate matter in micrograms per cubic meter
boone_health %>%
  arrange(year) %>%
  select(year, airpollutionparticulatematter_averagedailypm25)
```
Finding: Air quality has improved. PM2.5 levels fell from 10.15 to 8.1 in 2024.

O. HOUSING AND TRANSIT
20) How has the housing burden changed in Boone County?
```{r}
#Severe Housing Problems shows the percentage of households with at least 1 of 4 housing problems: overcrowding, high housing costs, lack of kitchen facilities, or lack of plumbing facilities.
boone_health %>%
  arrange(year) %>%
  select(year, `severehousingproblems_%severehousingproblems`)
```
Finding: Severe housing problems have slightly decreased, improving from 18% in 2015 to 16% in 2024.

21)How have commuting patterns changed for people who drive to work alone?
```{r}
#Driving Alone to Work means the percentage of the workforce that drives alone to work.
#Long Commute means the percentage that commute more than 30 minutes among workers who commute in their car alone 
boone_health %>%
  arrange(year) %>%
  select(year,
         `drivingalonetowork_%drivealonetowork`,
         `longcommutedrivingalone_%longcommutedrivesalone`)
```
Finding: The percentage of people driving alone to work and the share of those with long commutes have stayed fairly stable over the past decade, with no clear upward or downward trend.